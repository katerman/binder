<!DOCTYPE html>

<html>
<head>
    <title>Always bring your Binder</title>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="css/global.css" type="text/css">
	<link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>

	<style>
		body{
			font-family: 'Lato';
		}
		#attr-list li {
			margin: 10px 0;
		}

		strong {
			font-weight: 700;
		}

		#todo-list li {
			margin: 5px 0;
		}

		#todo-list button {
			margin-left: 5px;
		}

	</style>
</head>

<body>

    <div class="container">

		<nav data-template="templates/navbar.html" class="navbar navbar-default"></nav>

		<div class="col-md-12 main-content" data-template="templates/main-content.html"></div>

    </div>

    <script src="https://code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<script src="js/site.js"></script>
	<script type="text/javascript" src="js/databinder.js"></script>
    <script>

		var binder = new Binder();

		binder.properties.set('debug', false);

		binder.model('update-test','chocolate');

		binder.controller('clickOnDocs', function(){
			$('#navbar-collapse li').eq(1).click();
		});

		//Fire this after init finishes
		binder.extend('finish',function(r){

			$('.nav a').first().click();

			//Need to display {{}} without them actually being replaced with a model, so we'll use /{/{ and /}/} and replace them with this
			$.each($('pre'),function(k,v){

				//get our element info
				var elem = $(v);
				var text = elem.text();

				//define new regex's to replace our fake brackets with
				var regex1 = new RegExp('\/{\/{','g');
				var regex2 = new RegExp('\/}\/}','g');

				//replace the foo'
				var newText = text.replace(regex1, '{{');
				newText = newText.replace(regex2, '}}');

				//update the text
				elem.text(newText);

			});

			//sticky doc sidebar nav
			var docnav = $('#doc-nav');
			console.log(docnav);
			$(window).scroll(function(e){

				if($(window).scrollTop() > 390 && $(window).width() > 976){
					docnav.addClass('fixed');
				}else{
					docnav.removeClass('fixed');
				}

			});

		});

		//navbar state controller
		binder.controller('navbar-status',function(e,v){
			var _this = $(e);
			if(_this.is('li')){
				_this.addClass('active');
				_this.siblings('li').removeClass('active');
			}else if(_this.is('.navbar-brand')){
				_this.parent().next().find('li').removeClass('active');
				_this.parent().next().find('li').first().addClass('active');
			}
		});


		//controllers for tests
		binder.controller('update-test2', function(e,v){// dom element, and dataModel value
			$(e).css('border', '5px solid #' + Math.random().toString(16).slice(2, 8) ); //add random border
			$('.hidden-text').text('update-test2\'s controller magically added me, cool huh?'); //add text to hidden p
		});

		binder.controller('test-tab-state',function(e,v){
			var _this = $(e);
			_this.addClass('active');
			_this.siblings('li').removeClass('active');
		});

		//delete button on todo list
		binder.extend({
			model: '', //not needed
			data: 'deleteTodoItem', //the data attribute to find the element
			callback: function(returnObj){ //on event fire this callback will happen
				var element = returnObj.element;

				$(element).parent('li').remove();

			},
			eventType: 'click'//what event we'll be using to fire our callback

		});

		//add button on todo list
		binder.extend({
			model: 'todo-input', //needed
			data: 'addTodoItem', //the data attribute to find the element
			callback: function(returnObj){ //on event fire this callback will happen

				var element = returnObj.element;
				var dataVal = returnObj.dataAttrVal;
				var modelVal = returnObj.model === undefined ? '' : returnObj.model.value;

				if(modelVal.length  > 0){
					var html = '<li><span>'+modelVal+'</span> <button data-toggleCheckTodoItem class="btn btn-success btn-xs">&check;</button> <button data-deleteTodoItem class="btn btn-danger btn-xs">X</button></li>';
					var todoList = $('#todo-list');
					var input = $('#todoInput');

					todoList.append(html); //append our new

					input.val('').focus(); //put focus back in the input
					binder.model('todo-input', ''); //reset the model to an empty value

				}

			},
			eventType: 'click'//what event we'll be using to fire our callback

		});

		//toggle strike through
		binder.extend({
			data: 'toggleCheckTodoItem', //the data attribute to find the element
			callback: function(returnObj){ //on event fire this callback will happen

				var element = returnObj.element;
				var dataVal = returnObj.dataAttrVal;
				var modelVal = returnObj.model === undefined ? '' : returnObj.model.value;

				$(element).siblings('span').first().css('text-decoration', 'line-through');
				$(element).remove();

			},
			eventType: 'click'

		});

		binder.init(); //init dataBinder

    </script>
</body>
</html>
